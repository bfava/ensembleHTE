% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis_hte.R
\name{clan}
\alias{clan}
\title{Compute CLAN (Classification Analysis)}
\usage{
clan(
  ensemble_fit,
  variables = NULL,
  n_groups = 3,
  na_rm = FALSE,
  scale = FALSE,
  subset = NULL
)
}
\arguments{
\item{ensemble_fit}{An object of class `ensemble_hte_fit` from `ensemble_hte()`
or `ensemble_pred_fit` from `ensemble_pred()`.}

\item{variables}{Either:
\itemize{
  \item \code{NULL} (default): Uses all covariates from the ensemble fit (i.e., \code{names(ensemble_fit$X)})
  \item Character vector of variable names present in the `data` used in the ensemble function
  \item A data.frame/data.table with covariates to analyze (must have same number of rows as data)
}}

\item{n_groups}{Number of groups to divide the sample into (default: 3).
CLAN compares the top group (highest predicted ITE or Y) to others.}

\item{na_rm}{Logical, whether to remove NA values when computing means and
variances (default: FALSE). If FALSE and NAs are present, results will be NA.}

\item{scale}{Logical, whether to scale non-binary variables to have mean 0
and standard deviation 1 before computing differences (default: FALSE).
This makes coefficients comparable across variables with different scales.}

\item{subset}{Which observations to use for the CLAN analysis. Options:
\itemize{
  \item NULL (default): uses all observations (or training obs for \code{ensemble_pred_fit}
    when using the default outcome with subset training)
  \item \code{"train"}: uses only training observations (for \code{ensemble_pred_fit} only)
  \item \code{"all"}: explicitly uses all observations
  \item Logical vector: TRUE/FALSE for each observation (must have same length as data)
  \item Integer vector: indices of observations to include (1-indexed)
}
This allows evaluating CLAN on a subset of observations.}
}
\value{
An object of class `clan_results` containing:
\itemize{
  \item estimates: data.table with CLAN estimates averaged across repetitions
  \item variables: variables analyzed
  \item n_groups: number of groups used
  \item targeted_outcome: the outcome used for prediction
  \item fit_type: "hte" or "pred" depending on input
  \item M: number of repetitions
  \item scaled: whether variables were scaled
  \item call: the function call
}
}
\description{
Computes Classification Analysis (CLAN), an analysis introduced by
Chernozhukov et al. (2025) to characterize which units have the highest
and lowest predicted treatment effects or predicted outcomes.

This function implements the multiple-split estimation strategy developed by
Fava (2025), which combines predictions from multiple machine learning algorithms
into an ensemble and averages CLAN estimates across M repetitions of K-fold
cross-fitting to improve statistical power.

CLAN compares the mean of covariates between units in the top group of predicted
values versus: (1) bottom group, (2) all other units (else), and (3) all units.
Groups are formed by ranking predictions within each fold.
}
\examples{
\donttest{
set.seed(123)
n <- 500
X1 <- rnorm(n); X2 <- rnorm(n)
D <- rbinom(n, 1, 0.5)
Y <- X1 + D * (1 + 0.5 * X1) + rnorm(n)
data <- data.frame(Y = Y, D = D, X1 = X1, X2 = X2)

fit <- ensemble_hte(Y ~ X1 + X2, treatment = D, data = data,
                    algorithms = c("lm", "grf"), M = 3, K = 3)
result <- clan(fit)
print(result)
plot(result)
}

}
\references{
Chernozhukov, V., Demirer, M., Duflo, E., & Fernández-Val, I. (2025).
Fisher–Schultz Lecture: Generic Machine Learning Inference on Heterogeneous
Treatment Effects in Randomized Experiments, with an Application to Immunization
in India. \emph{Econometrica}, 93(4), 1121-1164.

Fava, B. (2025). Training and Testing with Multiple Splits: A Central Limit
Theorem for Split-Sample Estimators. \emph{arXiv preprint arXiv:2511.04957}.
}
